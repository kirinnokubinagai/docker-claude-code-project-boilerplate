# Claude Code 開発ガイドライン

このファイルはClaude Codeが自動的に参照し、最高品質のコードを生み出すための指示書です。

## 🎯 基本原則

### 実行フロー判定

```
┌─────────────────────────────┐
│ ユーザーのリクエストを受信    │
└──────────┬──────────────────┘
           │
           ▼
┌─────────────────────────────┐
│ 新規プロジェクト作成？        │
│ 「〇〇を作りたい」            │
└──────┬───────────┬──────────┘
       │YES        │NO
       ▼           ▼
┌──────────────┐ ┌───────────────┐
│ チーム構成    │ │ 通常の開発作業 │
│ フロー実行    │ │ ・バグ修正     │
│ → 停止！     │ │ ・機能追加     │
└──────────────┘ │ ・質問回答     │
                 └───────────────┘
```

## 🚀 新規プロジェクト作成フロー

### 実行手順（自動実行）

1. **プロジェクト分析**
   - 要件整理とタイプ判定（web/mobile/ai/blockchain等）
   - **全機能を一発で実装する前提で機能洗い出し**
   - MVPやフェーズ分けはしない（完全版を作る）

2. **技術選定**
   - Web検索で最新トレンドを調査（直近半年）
   - Context7で最新バージョン確認
   - VibeCodingに適した技術スタック決定
   - **プロダクション完成形を想定した技術選定**

3. **要件定義書作成**
   ```bash
   # requirements.mdを作成（Masterが参照する）
   cat > requirements.md << 'EOF'
   # プロジェクト要件定義
   
   ## 概要
   [プロジェクトの説明]
   
   ## 技術スタック
   - Frontend: [選定した技術]
   - Backend: [選定した技術]
   - Database: [選定した技術]
   
   ## タスクリスト（詳細）
   
   ### 🎨 Frontend Tasks
   #### 認証システム
   - [ ] ログイン画面のデザイン作成（Magic MCP使用）
   - [ ] ログインフォームコンポーネント実装（Magic MCP使用）
   - [ ] バリデーション処理実装
   - [ ] エラーメッセージ表示機能（Magic MCP使用）
   - [ ] パスワードリセット画面実装（Magic MCP使用）
   - [ ] 新規登録画面実装（Magic MCP使用）
   - [ ] メールアドレス確認フロー実装
   - [ ] ソーシャルログインボタン追加（Magic MCP使用）
   - [ ] Remember Me機能実装
   - [ ] 自動ログアウト機能実装
   
   #### ダッシュボード
   - [ ] ダッシュボードレイアウト設計（Magic MCP使用）
   - [ ] ヘッダーコンポーネント作成（Magic MCP使用）
   - [ ] サイドバーナビゲーション実装（Magic MCP使用）
   - [ ] ウィジェットコンポーネント作成（Magic MCP使用）
   - [ ] グラフ表示機能実装
   - [ ] リアルタイムデータ更新機能
   - [ ] フィルター機能実装
   - [ ] エクスポート機能追加
   
   #### レスポンシブ対応
   - [ ] モバイル用レイアウト作成（Magic MCP使用）
   - [ ] タブレット用レイアウト調整（Magic MCP使用）
   - [ ] ハンバーガーメニュー実装（Magic MCP使用）
   - [ ] タッチ操作対応
   - [ ] 画面回転対応
   
   ### 🔧 Backend Tasks
   #### API基盤
   - [ ] プロジェクト初期設定
   - [ ] ルーティング設定
   - [ ] ミドルウェア設定
   - [ ] エラーハンドリング実装
   - [ ] ロギングシステム構築
   - [ ] APIドキュメント自動生成設定
   
   #### 認証API
   - [ ] ユーザーモデル定義
   - [ ] JWT実装
   - [ ] ログインエンドポイント作成
   - [ ] ログアウトエンドポイント作成
   - [ ] トークンリフレッシュ機能
   - [ ] パスワードハッシュ化実装
   - [ ] メール送信機能実装
   - [ ] 2段階認証対応
   
   #### データ処理
   - [ ] CRUD APIエンドポイント作成
   - [ ] バリデーション処理実装
   - [ ] ページネーション実装
   - [ ] ソート機能実装
   - [ ] 検索機能実装
   - [ ] バッチ処理機能
   
   ### 🗄️ Database Tasks
   #### スキーマ設計
   - [ ] ER図作成
   - [ ] テーブル定義書作成
   - [ ] インデックス設計
   - [ ] 外部キー制約設定
   
   #### マイグレーション
   - [ ] 初期マイグレーションファイル作成
   - [ ] シードデータ作成
   - [ ] マイグレーションスクリプト作成
   
   ### 🚀 DevOps Tasks
   #### 環境構築
   - [ ] Dockerfile作成
   - [ ] docker-compose.yml作成
   - [ ] 環境変数設定
   - [ ] 開発環境構築手順書作成
   
   #### CI/CD
   - [ ] GitHub Actions設定
   - [ ] 自動テスト設定
   - [ ] 自動デプロイ設定
   - [ ] コード品質チェック設定
   
   ## 進捗管理
   - 完了したタスクは [x] にチェックを入れる
   - 各タスクは可能な限り1-2時間で完了できる粒度に分割
   - 依存関係がある場合は明記する
   - **新たに必要なタスクが判明したら随時追加する**
   - **全機能を一発で完成させる（フェーズ分けなし）**
   
   ## タスク追加ルール
   - 開発中に必要になったタスクは即座に追加
   - 適切なカテゴリーに配置
   - 同じ粒度で記載
   - 例: - [ ] [新規追加] エラー通知コンポーネント実装
   EOF
   ```

4. **Git初期化とリポジトリ作成**
   ```bash
   git init
   git add .
   git commit -m "feat: プロジェクト初期化"
   # GitHubリポジトリ作成（対話形式）
   ```

5. **タスク分割とチーム編成**
   - requirements.mdに基づいてタスクを詳細分割
   - 必要なチーム数とメンバー数を決定
   - teams.jsonを `/opt/claude-system/config/teams.json` に生成

6. **🛑 ここで必ず停止！**

### teams.json形式（厳守）

```json
{
  "project_name": "プロジェクト名",
  "project_type": "web-app",
  "teams": [
    {
      "id": "frontend",          // 必須: frontend/backend/database/devops等
      "name": "Frontend Team",    // 必須: チーム表示名
      "description": "UI/UX開発",
      "member_count": 3,          // 必須: 1-4の整数（1人目が必ずBoss）
      "tech_stack": "Next.js, TypeScript",
      "branch": "team/frontend"   // 必須: team/[id]形式
    }
  ]
}
```

### Master Claudeの動作フロー

```
1. Masterペインでrequirements.mdを参照
   cat requirements.md でタスクリストを確認

2. 未完了タスク（- [ ]）を抽出して優先順位付け
   依存関係を考慮して実行可能なタスクを選定

3. 各チームのBossに指示を出す（階層的指示システム）
   Master → Boss → メンバーの流れで指示が伝達される
   例: tmux send-keys -t claude-teams:1.1 "認証システムのタスクを進めてください" Enter

4. Bossがメンバーに具体的なタスクを割り当て
   Boss → メンバー1: "ログインフォームを実装してください"
   Boss → メンバー2: "バリデーション処理を実装してください"

5. Bossがタスク完了確認後、ブランチでコミット
   git add . && git commit -m "feat: 認証システム実装"

6. MasterがBossからの報告を受けてマージ
   - requirements.mdを更新（完了: - [ ] を - [x] に変更）
   - 新規タスク発生: 適切な場所に追加
   - ブランチをメインにマージ

7. 全タスクが完了するまで3-6を繰り返す
   目標: requirements.mdの全項目が [x] になること
```

#### コミュニケーションフローの例

```
Master: "Frontend Teamのboss、認証システムの実装を開始してください"
↓
Frontend Boss: "了解しました。メンバーにタスクを割り当てます"
↓
Frontend Boss → Member1: "ログインフォームのUI実装をお願いします"
Frontend Boss → Member2: "バリデーション処理を実装してください"
Frontend Boss → Member3: "エラーメッセージ表示機能を実装してください"
↓
Members: （各自実装）
↓
Frontend Boss: "全タスク完了しました。コミットします"
git commit -m "feat: 認証システムのUI実装完了"
↓
Master: "確認しました。メインブランチにマージします"
```

#### タスク管理のベストプラクティス
- **完全実装主義**: MVP思考ではなく、完成品を一発で作る
- **動的タスク追加**: 開発中に必要なタスクは即座に追加
- **並列実行**: 依存関係のないタスクは同時進行
- **全員フル稼働**: 常に全メンバーがタスクを持つ状態を維持

## 💻 開発原則

### コード品質

```javascript
/**
 * 関数には必ずJSDocを記載
 * @param {Type} param - パラメータの説明
 * @returns {Type} 戻り値の説明
 */
function exampleFunction(param) {
  // 早期リターンで可読性向上
  if (!param) return null;
  
  // ネストは浅く、処理は明確に
  return processValue(param);
}
```

### コーディングルール

- **関数Doc**: 必ず記載（引数・返り値の説明含む）
- **関数内コメント**: 禁止（必要なら関数を分割）
- **早期リターン**: 推奨（else/elseifは避ける）
- **ネスト**: 最大3階層まで
- **変数名**: 意味が明確で検索しやすい名前

### デザイン作成時の注意事項

**重要: UIコンポーネントやデザインを作成する際は、必ずMagic MCPを使用すること**

```bash
# デザイン作成時の基本フロー
1. Magic MCPを使用してUIコンポーネントを生成
2. 生成されたコンポーネントをプロジェクトに統合
3. 必要に応じてカスタマイズ
```

#### Magic MCP使用例
- ログインフォームのデザイン → Magic MCPで生成
- ダッシュボードレイアウト → Magic MCPで生成
- ボタンやカードコンポーネント → Magic MCPで生成
- レスポンシブナビゲーション → Magic MCPで生成

### テスト駆動開発

1. **実装前にテストを書く**
2. **Playwrightで機能テスト**
3. **テスト失敗 → 修正 → 再テスト**
4. **全テスト通過後にコミット**

## 🔧 技術選定基準

### 評価ポイント

1. **最新性**: 最新安定版を使用
2. **実績**: プロダクション実績
3. **DX**: 開発体験の良さ
4. **性能**: ベンチマーク結果
5. **保守性**: 長期的なメンテナンス


## 📊 プロジェクトタイプ別チーム構成

### Webアプリケーション
- Frontend Team（UI/UX）: 4名
- Backend Team（API）: 4名
- Database Team（データ）: 3名
- DevOps Team（インフラ）: 3名

### モバイルアプリ
- Mobile Team（アプリ）: 4名
- Backend Team（API）: 4名
- DevOps Team（配信）: 3名

### AIプロダクト
- AI Team（モデル）: 4名
- Backend Team（API）: 4名
- Frontend Team（UI）: 4名
- Data Team（データ）: 4名

## ⚡ クイックリファレンス

### コマンド早見表

```bash
# プロジェクト初期化
npm create vite@latest
npm create next-app@latest

# Git操作
git init && git add . && git commit -m "feat: 初期化"

# 開発サーバー
npm run dev
# 必ず終了: Ctrl+C

# Playwright
npx playwright test
# 必ず終了: プロセス確認
```

### よくあるミス

1. ❌ teams.jsonを表示だけ → ✅ ファイルに保存
2. ❌ 実装まで進める → ✅ チーム構成で停止
3. ❌ プロセス放置 → ✅ 必ず終了処理

## 📝 タスクリスト作成例

### SNSアプリの場合（完全版・一発実装）
```markdown
### 🎨 Frontend Tasks (50-70タスク想定)
#### 認証システム完全版
- [ ] ログイン画面のワイヤーフレーム作成
- [ ] ログインフォームのHTML構造作成（Magic MCP使用）
- [ ] フォームのスタイリング（Magic MCP使用）
- [ ] メールアドレスのバリデーション実装
- [ ] パスワードの表示/非表示トグル実装（Magic MCP使用）
- [ ] ソーシャルログイン（Google）実装（Magic MCP使用）
- [ ] ソーシャルログイン（Twitter）実装（Magic MCP使用）
- [ ] 2段階認証UI実装（Magic MCP使用）
- [ ] パスワードリセット完全フロー（Magic MCP使用）
- [ ] メール認証フロー実装
- [ ] [新規追加] reCAPTCHA統合
- [ ] [新規追加] ログイン履歴表示機能（Magic MCP使用）

#### 完全なタイムライン機能
- [ ] タイムラインのレイアウト設計（Magic MCP使用）
- [ ] 投稿カードコンポーネント作成（Magic MCP使用）
- [ ] リアルタイム更新（WebSocket）
- [ ] 無限スクロール実装
- [ ] 画像アップロード機能（Magic MCP使用）
- [ ] 動画アップロード機能（Magic MCP使用）
- [ ] GIF対応
- [ ] 絵文字ピッカー実装（Magic MCP使用）
- [ ] メンション機能（@ユーザー名）
- [ ] ハッシュタグ機能
- [ ] 引用投稿機能（Magic MCP使用）
- [ ] [新規追加] 投稿の予約機能（Magic MCP使用）
- [ ] [新規追加] 下書き保存機能

### 開発中の動的タスク追加例
- [ ] [新規追加] エラーバウンダリ実装
- [ ] [新規追加] パフォーマンス最適化
- [ ] [新規追加] アクセシビリティ対応
```

## 🎯 最重要ポイント

1. **新規プロジェクト = チーム構成のみ**
2. **既存プロジェクト = 通常作業**
3. **requirements.mdは完全版の詳細タスクリスト**
4. **フェーズ分けせず一発で全機能実装**
5. **開発中に必要なタスクは随時追加**
6. **teams.jsonは `/opt/claude-system/config/` に保存**
7. **生成後は必ず停止（Masterがtmuxで指示を出す）**
8. **UIデザイン作成時は必ずMagic MCPを使用**

---

**Mission**: 世界を変える完成品を、最高の品質で、一発で作る。