# Bunをベースイメージとして使用（ビルド用）
FROM oven/bun:1-alpine AS builder

WORKDIR /app

# 依存関係のインストール
COPY mcp-gateway/package.json ./
RUN bun install

# ソースコードをコピー
COPY mcp-gateway/ .

# ビルド
RUN bun run build

# 実行用イメージ
FROM node:20-alpine

WORKDIR /app

# プロキシサーバーの依存関係
RUN npm install express http-proxy-middleware

# ビルド成果物とプロキシサーバーをコピー
COPY --from=builder /app/dist ./mcp-gateway/dist
COPY mcp-client-proxy.js ./

EXPOSE 3002

# プロキシサーバーを起動
CMD ["node", "mcp-client-proxy.js"]